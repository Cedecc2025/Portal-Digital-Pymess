<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema PyME - Mi Negocio</title>
    <link rel="stylesheet" href="../../public/css/global.css" />
    <link rel="stylesheet" href="./css/catalogo.css" />

</head>
<body>
    <div class="container">
        <!-- Admin Banner -->
        <div class="admin-banner">
            üîê MODO ADMINISTRADOR ACTIVO
        </div>

        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <span class="logo">
                    <img id="businessLogo" src="" alt="" class="logo-img" style="display: none;">
                    <span id="logoIcon">üè™</span>
                    <span id="businessName">Mi Negocio</span>
                </span>
            </div>
            <div class="header-buttons">
                <button class="btn-header" onclick="openCart()">
                    üõí Carrito <span class="cart-badge" id="cartBadge">0</span>
                </button>
                <button class="btn-header whatsapp-btn admin-only" id="whatsappProcessBtn" onclick="showModal('whatsappProcessModal')">
                    üì± Procesar WhatsApp
                </button>
                <button class="btn-header" id="notificationBtn" onclick="toggleNotificationCenter()" style="display: none; position: relative;">
                    üîî Notificaciones
                    <span class="notification-count" id="notificationCount" style="display: none;">0</span>
                </button>
                <button class="btn-header" id="addProductBtn" onclick="showModal('productModal')" style="display: none;">
                    ‚ûï Producto
                </button>
                <button class="btn-header" id="logoutBtn" onclick="logout()" style="display: none;">
                    üö™ Salir Admin
                </button>
            </div>
        </header>

        <!-- Navigation Tabs (Admin Only) -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('catalog', this)">üì¶ Cat√°logo</button>
            <button class="nav-tab" onclick="showSection('dashboard', this)">üìä Dashboard</button>
            <button class="nav-tab" onclick="showSection('sales', this)">üí∞ Ventas</button>
            <button class="nav-tab" onclick="showSection('clients', this)">üë• Clientes</button>
            <button class="nav-tab" onclick="showSection('inventory', this)">üìã Inventario</button>
            <button class="nav-tab" onclick="showSection('chatbot', this)">ü§ñ Chatbot</button>
            <button class="nav-tab" onclick="showSection('settings', this)">‚öôÔ∏è Config</button>
        </div>

        <!-- Catalog Section (Always Visible) -->
        <section id="catalog" class="section active">
            <div class="controls">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar productos...">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterCategory('all', this)">Todos</button>
                    <button class="filter-btn" onclick="filterCategory('Alimentos', this)">Alimentos</button>
                    <button class="filter-btn" onclick="filterCategory('Bebidas', this)">Bebidas</button>
                    <button class="filter-btn" onclick="filterCategory('Tecnolog√≠a', this)">Tecnolog√≠a</button>
                    <button class="filter-btn" onclick="filterCategory('Hogar', this)">Hogar</button>
                    <button class="filter-btn" onclick="filterCategory('Ropa', this)">Ropa</button>
                    <button class="filter-btn" onclick="filterCategory('Otros', this)">Otros</button>
                </div>
            </div>
            
            <div class="products-grid" id="productsGrid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- Dashboard Section (Admin Only) -->
        <section id="dashboard" class="section">
            <h2 style="margin-bottom: 30px;">Panel de Control</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalSales">‚Ç°0</div>
                    <div class="stat-label">Ventas Totales</div>
                </div>
                <div class="stat-card" style="background: var(--gradient-2);">
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Clientes</div>
                </div>
                <div class="stat-card" style="background: var(--gradient-3);">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">Productos</div>
                </div>
                <div class="stat-card" style="background: var(--gradient-4);">
                    <div class="stat-value" id="todayOrders">0</div>
                    <div class="stat-label">Pedidos Hoy</div>
                </div>
            </div>

            <h3 style="margin: 30px 0 20px;">√öltimas Ventas</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="recentSalesTable">
                        <tr><td colspan="4" style="text-align: center;">No hay ventas</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Sales Section (Admin Only) -->
        <section id="sales" class="section">
            <!-- WhatsApp Processor Section -->
            <div class="whatsapp-processor">
                <h3>
                    üì± Procesador de Pedidos WhatsApp
                    <span class="tooltip" style="margin-left: 10px; font-size: 18px;">
                        ‚ÑπÔ∏è
                        <span class="tooltiptext">Pega aqu√≠ los mensajes de pedidos que recibes por WhatsApp para procesarlos autom√°ticamente</span>
                    </span>
                </h3>
                
                <div class="whatsapp-input-area">
                    <textarea 
                        class="whatsapp-textarea" 
                        id="whatsappMessageInput"
                        placeholder="Pega aqu√≠ el mensaje de WhatsApp...

Ejemplo:
üõçÔ∏è NUEVO PEDIDO

Cliente: Yuli
Tel√©fono: 50687592588

üì¶ Productos:
‚Ä¢ Camisa x1 = ‚Ç°2000

Subtotal: ‚Ç°2000
IVA (13%): ‚Ç°260
TOTAL: ‚Ç°2260"
                    ></textarea>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn-process" onclick="parseWhatsAppMessage()">
                        üîç Analizar Mensaje
                    </button>
                    <button class="btn-process" onclick="clearWhatsAppProcessor()" style="background: var(--danger); color: white;">
                        üóëÔ∏è Limpiar
                    </button>
                </div>
                
                <div class="parsed-data" id="parsedData">
                    <!-- Parsed data will appear here -->
                </div>
                
                <div class="process-status" id="processStatus">
                    <!-- Status messages will appear here -->
                </div>
            </div>

            <h2 style="margin: 30px 0;">Historial de Ventas</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="salesTable">
                        <tr><td colspan="6" style="text-align: center;">No hay ventas</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Clients Section (Admin Only) -->
        <section id="clients" class="section">
            <h2 style="margin-bottom: 30px;">Gesti√≥n de Clientes</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Tel√©fono</th>
                            <th>Direcci√≥n</th>
                            <th>Compras</th>
                            <th>Total Gastado</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTable">
                        <tr><td colspan="5" style="text-align: center;">No hay clientes</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Inventory Section (Admin Only) -->
        <section id="inventory" class="section">
            <h2 style="margin-bottom: 30px;">Control de Inventario</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Categor√≠a</th>
                            <th>Stock</th>
                            <th>Precio</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTable">
                        <tr><td colspan="5" style="text-align: center;">No hay productos</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Chatbot Section (Admin Only) -->
        <section id="chatbot" class="section">
            <h2 style="margin-bottom: 30px;">Configuraci√≥n del Chatbot</h2>
            
            <div style="background: var(--light); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">Configuraci√≥n General</h3>
                <div class="form-group">
                    <label class="form-label">Nombre del Asistente</label>
                    <input type="text" class="form-input" id="botName" placeholder="Ej: Asistente Virtual">
                </div>
                <div class="form-group">
                    <label class="form-label">Mensaje de Bienvenida</label>
                    <textarea class="form-textarea" id="botWelcome" placeholder="¬°Hola! Soy tu asistente virtual. ¬øEn qu√© puedo ayudarte hoy?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="botEnabled" checked> Chatbot Activado
                    </label>
                </div>
                <button class="btn-primary" onclick="saveChatbotSettings()">Guardar Configuraci√≥n</button>
            </div>

            <div style="background: var(--light); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">Preguntas Frecuentes (FAQ)</h3>
                <div id="faqList" style="margin-bottom: 20px;">
                    <!-- FAQ items will be loaded here -->
                </div>
                <button class="btn-primary" onclick="addFAQ()">‚ûï Agregar Pregunta</button>
            </div>

            <div style="background: var(--light); padding: 25px; border-radius: 15px;">
                <h3 style="margin-bottom: 20px;">Respuestas R√°pidas</h3>
                <div class="form-group">
                    <label class="form-label">Horario de Atenci√≥n</label>
                    <input type="text" class="form-input" id="botHours" placeholder="Lunes a Viernes: 8am - 6pm">
                </div>
                <div class="form-group">
                    <label class="form-label">Tiempo de Entrega</label>
                    <input type="text" class="form-input" id="botDelivery" placeholder="24-48 horas en el GAM">
                </div>
                <div class="form-group">
                    <label class="form-label">M√©todos de Pago</label>
                    <input type="text" class="form-input" id="botPayment" placeholder="Efectivo, SINPE, Transferencia">
                </div>
                <button class="btn-primary" onclick="saveQuickResponses()">Guardar Respuestas</button>
            </div>
        </section>

        <!-- Settings Section (Admin Only) -->
        <section id="settings" class="section">
            <h2 style="margin-bottom: 30px;">Configuraci√≥n</h2>
            
            <div style="background: var(--light); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">Informaci√≥n del Negocio</h3>
                <div class="form-group">
                    <label class="form-label">Nombre del Negocio</label>
                    <input type="text" class="form-input" id="settingsBusinessName" placeholder="Mi Negocio">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Logo del Negocio</label>
                    <input type="url" class="form-input" id="settingsLogoUrl" placeholder="https://ejemplo.com/logo.png" style="margin-bottom: 10px;">
                    <input type="file" id="logoFileInput" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                    <button type="button" class="btn-primary" onclick="document.getElementById('logoFileInput').click()">
                        üì∑ Subir Logo
                    </button>
                    <button type="button" class="btn-primary btn-danger" onclick="removeLogo()" id="removeLogoBtn" style="margin-left: 10px; display: none;">
                        üóëÔ∏è Quitar Logo
                    </button>
                    <div id="logoPreview" style="margin-top: 15px;"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">WhatsApp (incluir c√≥digo de pa√≠s)</label>
                    <input type="text" class="form-input" id="settingsWhatsApp" placeholder="50688888888">
                </div>
                <div class="form-group">
                    <label class="form-label">Correo Electr√≥nico</label>
                    <input type="email" class="form-input" id="settingsEmail" placeholder="correo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Contrase√±a Admin</label>
                    <input type="password" class="form-input" id="settingsPassword" placeholder="Nueva contrase√±a">
                </div>
                <button class="btn-primary" onclick="saveSettings()">Guardar Configuraci√≥n</button>
            </div>
            
            <div style="background: var(--light); padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">Personalizaci√≥n de Colores</h3>
                <div class="color-picker-group">
                    <label style="width: 150px;">Color Principal:</label>
                    <input type="color" id="primaryColor" class="color-input" value="#2563eb">
                    <input type="text" class="form-input" id="primaryColorHex" value="#2563eb" style="width: 100px;" onchange="updateColorFromHex('primary')">
                </div>
                <div class="color-picker-group">
                    <label style="width: 150px;">Fondo degradado:</label>
                    <input type="color" id="bgColor1" class="color-input" value="#667eea">
                    <span>hasta</span>
                    <input type="color" id="bgColor2" class="color-input" value="#764ba2">
                </div>
                <button class="btn-primary" onclick="saveColors()">Aplicar Colores</button>
                <button class="btn-primary btn-warning" onclick="resetColors()" style="margin-left: 10px;">üîÑ Restaurar Colores</button>
            </div>
            
            <div style="background: var(--light); padding: 25px; border-radius: 15px;">
                <h3 style="margin-bottom: 20px;">Backup y Restauraci√≥n</h3>
                <button class="btn-primary" onclick="exportData()">üíæ Exportar Datos</button>
                <button class="btn-primary btn-warning" onclick="importData()" style="margin-left: 10px;">üìÇ Importar</button>
                <button class="btn-primary btn-danger" onclick="factoryReset()" style="margin-left: 10px;">üè≠ Reinicio Total</button>
            </div>
        </section>
    </div>

    <!-- Admin Lock Button -->
    <div class="admin-lock" id="adminLock" onclick="showAdminLogin()">
        üîí
    </div>

    <!-- Notification Dropdown -->
    <div class="notification-dropdown" id="notificationDropdown">
        <div class="notification-dropdown-header">
            <span class="notification-dropdown-title">üì¨ Centro de Notificaciones</span>
            <button class="clear-notifications-btn" onclick="clearAllNotifications()">Limpiar todo</button>
        </div>
        <div class="notification-list" id="notificationList">
            <div class="notification-empty">
                <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>
                <p>No hay notificaciones nuevas</p>
            </div>
        </div>
        <div class="notification-settings">
            <label class="notification-toggle">
                <input type="checkbox" id="notificationSound" checked>
                <span style="font-size: 14px;">üîä Sonido de notificaciones</span>
            </label>
            <label class="notification-toggle" style="margin-top: 10px;">
                <input type="checkbox" id="browserNotifications" onclick="toggleBrowserNotifications()">
                <span style="font-size: 14px;">üåê Notificaciones del navegador</span>
            </label>
        </div>
    </div>

    <!-- Purchase Popup -->
    <div class="purchase-popup" id="purchasePopup">
        <button style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;" onclick="closePurchasePopup()">√ó</button>
        <div class="purchase-popup-header">
            <div class="purchase-popup-icon">üõçÔ∏è</div>
            <div class="purchase-popup-content">
                <h3>¬°Nueva Compra Recibida!</h3>
                <div class="purchase-popup-details" id="purchaseDetails">
                    <!-- Details will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Widget -->
    <div class="chatbot-widget" id="chatbotWidget" style="display: none;">
        <button class="chatbot-button" onclick="toggleChatbot()">
            üí¨
            <span class="notification-dot"></span>
        </button>
        
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <h3>
                    <span class="chatbot-status"></span>
                    <span id="chatbotTitle">Asistente Virtual</span>
                </h3>
                <button class="chatbot-close" onclick="toggleChatbot()">&times;</button>
            </div>
            
            <div class="chatbot-messages" id="chatMessages">
                <!-- Messages will appear here -->
            </div>
            
            <div class="chatbot-typing" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="chatbot-options" id="chatOptions">
                <button class="chat-option-btn" onclick="sendQuickMessage('horario')">üïê Horario de atenci√≥n</button>
                <button class="chat-option-btn" onclick="sendQuickMessage('entrega')">üöö Tiempos de entrega</button>
                <button class="chat-option-btn" onclick="sendQuickMessage('pago')">üí≥ M√©todos de pago</button>
                <button class="chat-option-btn" onclick="sendQuickMessage('contacto')">üìû Contactar vendedor</button>
            </div>
            
            <div class="chatbot-input">
                <input type="text" class="chat-input" id="chatInput" placeholder="Escribe tu pregunta..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                <button class="chat-send" onclick="sendChatMessage()">‚û§</button>
            </div>
        </div>
    </div>

    <!-- WhatsApp Process Modal -->
    <div class="modal" id="whatsappProcessModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì± Procesar Pedido de WhatsApp</h2>
                <button class="close-modal" onclick="closeModal('whatsappProcessModal')">&times;</button>
            </div>
            
            <div style="background: var(--light); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <p style="font-size: 14px; color: #6b7280;">
                    üí° <strong>Instrucciones:</strong> Copia y pega el mensaje completo del pedido que recibiste por WhatsApp. 
                    El sistema detectar√° autom√°ticamente el cliente, productos y totales.
                </p>
            </div>
            
            <textarea 
                class="form-textarea" 
                id="modalWhatsappInput"
                style="min-height: 200px; font-family: 'Courier New', monospace;"
                placeholder="Pega aqu√≠ el mensaje de WhatsApp..."
            ></textarea>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn-primary" onclick="processWhatsAppFromModal()">
                    üîç Procesar Pedido
                </button>
                <button class="btn-primary btn-danger" onclick="closeModal('whatsappProcessModal')">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üõí Carrito de Compras</h2>
                <button class="close-modal" onclick="closeModal('cartModal')">&times;</button>
            </div>

            <div class="cart-items" id="cartItems">
                <div class="empty-state">
                    <div class="empty-state-icon">üõí</div>
                    <p>Tu carrito est√° vac√≠o</p>
                </div>
            </div>

            <div id="clientForm" style="display: none;">
                <h3 style="margin: 20px 0 15px;">Informaci√≥n de Contacto</h3>
                <div class="form-group">
                    <label class="form-label">Nombre *</label>
                    <input type="text" class="form-input" id="clientName">
                    <div class="error-message" id="nameError">Campo obligatorio</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Tel√©fono *</label>
                    <input type="tel" class="form-input" id="clientPhone" placeholder="88888888">
                    <div class="error-message" id="phoneError">Campo obligatorio</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Direcci√≥n</label>
                    <textarea class="form-textarea" id="clientAddress" placeholder="Direcci√≥n de entrega"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Notas del Pedido</label>
                    <textarea class="form-textarea" id="clientNotes" placeholder="Instrucciones especiales, horario de entrega, etc."></textarea>
                </div>
            </div>

            <div class="cart-total" id="cartTotal" style="display: none;">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">‚Ç°0</span>
                </div>
                <div class="total-row">
                    <span>IVA (13%):</span>
                    <span id="tax">‚Ç°0</span>
                </div>
                <div class="total-row final">
                    <span>Total:</span>
                    <span id="total">‚Ç°0</span>
                </div>
                <button class="btn-primary btn-whatsapp" id="sendWhatsAppBtn" onclick="sendWhatsApp()" style="width: 100%; margin-top: 15px;">
                    üì± Enviar Pedido por WhatsApp
                </button>
                <p id="orderInfo" style="margin-top: 10px; text-align: center; color: white; font-size: 12px; opacity: 0.8;">
                    Al enviar, se actualizar√° el inventario y se registrar√° la venta
                </p>
            </div>
        </div>
    </div>

    <!-- Product Modal (Admin) -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="productModalTitle">Agregar Producto</h2>
                <button class="close-modal" onclick="closeModal('productModal')">&times;</button>
            </div>
            
            <form onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                
                <div class="image-upload-section">
                    <h4>Imagen del Producto</h4>
                    <img id="imagePreview" class="image-preview">
                    <input type="file" id="productImageFile" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    <button type="button" class="btn-primary" onclick="document.getElementById('productImageFile').click()">
                        üì∑ Seleccionar Imagen
                    </button>
                    <input type="url" class="form-input" id="productImageUrl" placeholder="O pega URL de imagen" style="margin-top: 10px;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre *</label>
                    <input type="text" class="form-input" id="productName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Categor√≠a *</label>
                    <select class="form-select" id="productCategory" required>
                        <option value="">Seleccionar...</option>
                        <option value="Alimentos">Alimentos</option>
                        <option value="Bebidas">Bebidas</option>
                        <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                        <option value="Hogar">Hogar</option>
                        <option value="Ropa">Ropa</option>
                        <option value="Salud">Salud</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descripci√≥n</label>
                    <textarea class="form-textarea" id="productDescription"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Precio *</label>
                    <input type="number" class="form-input" id="productPrice" required min="0">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Stock *</label>
                    <input type="number" class="form-input" id="productStock" required min="0">
                </div>
                
                <button type="submit" class="btn-primary" style="width: 100%;">
                    Guardar Producto
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal" id="adminModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 class="modal-title">üîê Acceso Administrativo</h2>
                <button class="close-modal" onclick="closeModal('adminModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Contrase√±a</label>
                <input type="password" class="form-input" id="adminPassword" placeholder="Ingresa la contrase√±a" onkeypress="if(event.key==='Enter') login()">
            </div>
            
            <button class="btn-primary" onclick="login()" style="width: 100%;">
                Ingresar
            </button>
            
            <p style="margin-top: 15px; text-align: center; color: #6b7280; font-size: 14px;">
                Contrase√±a por defecto: admin123
            </p>
        </div>
    </div>

    <script src="./js/catalogo.js" defer></script>
</body>
</html>
